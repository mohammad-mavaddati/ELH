<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>چت خصوصی محمد و الهام</title>
  <style>
    body { font-family: sans-serif; direction: rtl; background: #f0f0f0; padding: 20px; max-width: 600px; margin: auto; }
    #chat { background: white; padding: 10px; border-radius: 10px; max-height: 400px; overflow-y: auto; margin-bottom: 10px; }
    .msg { margin: 5px 0; padding: 5px 10px; border-radius: 10px; }
    .from-me { background: #d0ffd0; text-align: right; }
    .from-other { background: #d0d0ff; text-align: left; }
    #controls { display: flex; gap: 10px; }
    button { cursor: pointer; }
  </style>
</head>
<body>
  <h2>ورود به چت</h2>
  <div id="auth">
    <label>ماه تولد:
      <select id="birth-month">
        <option value="">-- انتخاب ماه --</option>
        <option value="10">دی</option>
        <option value="1">فروردین</option>
        <option value="2">اردیبهشت</option>
      </select>
    </label>
    <label>روز تولد:
      <select id="birth-day">
        <option value="">-- انتخاب روز --</option>
        <script>
          for (let i = 1; i <= 31; i++) {
            document.write(`<option value="${i}">${i}</option>`);
          }
        </script>
      </select>
    </label>
    <div id="password-container" style="display:none">
      <label>رمز عبور:
        <input type="password" id="password">
      </label>
    </div>
    <button onclick="login()">ورود</button>
  </div>

  <div id="chat-ui" style="display:none">
    <div id="chat"></div>
    <div id="controls">
      <input type="text" id="msg" placeholder="پیام بنویسید">
      <button onclick="sendMessage()">ارسال</button>
    </div>
    <div id="admin-controls" style="display:none">
      <button onclick="clearHistory()">پاک کردن تاریخچه</button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyA5_iPT-1YjlJgKCsl6wNAIb-jsCTyoSKI",
      authDomain: "elhh-e2eee.firebaseapp.com",
      databaseURL: "https://elhh-e2eee-default-rtdb.firebaseio.com",
      projectId: "elhh-e2eee",
      storageBucket: "elhh-e2eee.firebasestorage.app",
      messagingSenderId: "1035622425636",
      appId: "1:1035622425636:web:09dd18e687490f9e22a4b1",
      measurementId: "G-2X7EH2QCJE"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let user = null;

    window.login = function () {
      const day = parseInt(document.getElementById('birth-day').value);
      const month = parseInt(document.getElementById('birth-month').value);

      if (month === 10 && day === 7) {
        user = 'محمد';
        document.getElementById('password-container').style.display = 'block';
        const pass = document.getElementById('password').value;
        if (pass !== 'mohamad200') {
          alert('رمز اشتباه است');
          return;
        }
      } else if (month === 10 && day === 13) {
        user = 'الهام';
      } else {
        alert('فقط محمد و الهام اجازه ورود دارند.');
        return;
      }

      document.getElementById('auth').style.display = 'none';
      document.getElementById('chat-ui').style.display = 'block';
      if (user === 'محمد') document.getElementById('admin-controls').style.display = 'block';

      const chat = document.getElementById('chat');
      const messagesRef = ref(db, 'messages');
      onValue(messagesRef, (snapshot) => {
        chat.innerHTML = '';
        const msgs = snapshot.val();
        for (let key in msgs) {
          const msg = msgs[key];
          const div = document.createElement('div');
          div.className = 'msg ' + (msg.from === user ? 'from-me' : 'from-other');
          div.textContent = msg.from + ': ' + msg.text;

          if (user === 'محمد') {
            const del = document.createElement('button');
            del.textContent = 'حذف';
            del.style.marginRight = '10px';
            del.onclick = () => remove(ref(db, 'messages/' + key));
            div.appendChild(del);
          }

          chat.appendChild(div);
        }
        chat.scrollTop = chat.scrollHeight;
      });
    };

    window.sendMessage = function () {
      const input = document.getElementById('msg');
      const text = input.value.trim();
      if (text) {
        push(ref(db, 'messages'), { from: user, text });
        input.value = '';
      }
    };

    window.clearHistory = function () {
      if (confirm('همه پیام‌ها پاک شوند؟')) {
        remove(ref(db, 'messages'));
      }
    };
  </script>
</body>
</html>
