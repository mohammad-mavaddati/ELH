<!DOCTYPE html><html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>چت آنلاین</title>
    <style>
        body { font-family: Arial, sans-serif; direction: rtl; margin: 0; padding: 0; }
        #login, #chat { max-width: 500px; margin: 50px auto; }
        #messages { border: 1px solid #ccc; height: 300px; overflow-y: scroll; padding: 10px; }
        .message { margin-bottom: 10px; padding: 5px; border-radius: 5px; background: #f1f1f1; position: relative; }
        .message .sender { font-weight: bold; margin-bottom: 3px; }
        .message button.delete { position: absolute; left: 5px; top: 5px; background: transparent; border: none; cursor: pointer; }
        #controls { margin-top: 10px; display: flex; gap: 10px; }
        button { padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer; }
        button#send { background-color: #28a745; color: white; }
        button#clear { background-color: #dc3545; color: white; }
    </style>
</head>
<body>
    <div id="login">
        <h3>ورود به چت</h3>
        <label>ماه تولد:</label>
        <select id="month">
            <option value="1">فروردین</option>
            <option value="2">اردیبهشت</option>
            <option value="3">خرداد</option>
            <option value="4">تیر</option>
            <option value="5">مرداد</option>
            <option value="6">شهریور</option>
            <option value="7">مهر</option>
            <option value="8">آبان</option>
            <option value="9">آذر</option>
            <option value="10">دی</option>
            <option value="11">بهمن</option>
            <option value="12">اسفند</option>
        </select>
        <label>روز تولد:</label>
        <select id="day"></select>
        <div id="password-container" style="display:none;">
            <label>رمز:</label>
            <input type="password" id="password" />
        </div>
        <button id="loginBtn">ورود</button>
    </div><div id="chat" style="display:none;">
    <h3>چت آنلاین</h3>
    <div id="messages"></div>
    <div id="controls">
        <input type="text" id="msgInput" placeholder="پیام خود را بنویسید..." style="flex:1; padding:8px;" />
        <button id="send">ارسال</button>
    </div>
    <button id="clear" style="display:none; margin-top:10px;">حذف تاریخچه</button>
</div>

<script type="module">
    // Import Firebase functions
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-app.js";
    import { getDatabase, ref, onValue, push, set, remove } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-database.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.8.1/firebase-analytics.js";

    // Firebase config
    const firebaseConfig = {
        apiKey: "AIzaSyCZwJpIq3E4pvYmrHixi5ZSCJPbYPjXRt8",
        authDomain: "elha-4d00a.firebaseapp.com",
        databaseURL: "https://elha-4d00a-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "elha-4d00a",
        storageBucket: "elha-4d00a.firebasestorage.app",
        messagingSenderId: "464090098680",
        appId: "1:464090098680:web:ceec4cf10f08c7fe2f040d",
        measurementId: "G-78Q4CHE5TE"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getDatabase(app);

    // Populate day select
    const month = document.getElementById('month');
    const day = document.getElementById('day');
    for (let i = 1; i <= 31; i++) {
        const opt = document.createElement('option'); opt.value = i; opt.textContent = i;
        day.appendChild(opt);
    }

    const passwordContainer = document.getElementById('password-container');
    let currentUser = null;

    month.addEventListener('change', checkUser);
    day.addEventListener('change', checkUser);

    function checkUser() {
        const m = parseInt(month.value);
        const d = parseInt(day.value);
        if (m === 10 && d === 7) { currentUser = 'Mohammad'; passwordContainer.style.display = 'block'; }
        else if (m === 10 && d === 13) { currentUser = 'Elham'; passwordContainer.style.display = 'none'; }
        else { currentUser = null; passwordContainer.style.display = 'none'; }
    }

    document.getElementById('loginBtn').addEventListener('click', () => {
        if (!currentUser) { alert('تاریخ تولد معتبر نیست.'); return; }
        if (currentUser === 'Mohammad') {
            const pw = document.getElementById('password').value;
            if (pw !== 'mohamad200') { alert('رمز نادرست'); return; }
        }
        document.getElementById('login').style.display = 'none';
        document.getElementById('chat').style.display = 'block';
        if (currentUser === 'Mohammad') document.getElementById('clear').style.display = 'block';
        listenMessages();
    });

    function listenMessages() {
        const msgsRef = ref(db, 'messages');
        onValue(msgsRef, snapshot => {
            const messagesDiv = document.getElementById('messages');
            messagesDiv.innerHTML = '';
            const data = snapshot.val(); if (!data) return;
            Object.keys(data).forEach(key => {
                const m = data[key];
                const div = document.createElement('div'); div.className = 'message';
                div.innerHTML = `<div class='sender'>${m.sender}</div><div class='text'>${m.text}</div>`;
                if (currentUser === 'Mohammad') {
                    const btn = document.createElement('button'); btn.textContent = '❌'; btn.className = 'delete';
                    btn.onclick = () => remove(ref(db, `messages/${key}`));
                    div.appendChild(btn);
                }
                messagesDiv.appendChild(div);
            });
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        });
    }

    document.getElementById('send').addEventListener('click', () => {
        const text = document.getElementById('msgInput').value.trim(); if (!text) return;
        const msgsRef = ref(db, 'messages');
        const newRef = push(msgsRef);
        set(newRef, { sender: currentUser, text });
        document.getElementById('msgInput').value = '';
    });

    document.getElementById('clear').addEventListener('click', () => {
        if (confirm('آیا مطمئنید که تمام تاریخچه حذف شود؟')) {
            remove(ref(db, 'messages'));
        }
    });
</script>

</body>
</html>
